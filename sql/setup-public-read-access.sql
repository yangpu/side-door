-- ====================================================================
-- SideDoor 稍后阅读主页 - 公开访问权限设置
-- ====================================================================
-- 
-- 此脚本用于配置 Supabase 数据库，允许公开访问稍后阅读列表
-- 
-- 使用方法:
-- 1. 登录 Supabase Dashboard
-- 2. 进入 SQL Editor
-- 3. 复制并执行此脚本
-- 
-- 注意:
-- - 执行此脚本后，任何人都可以通过 API 读取你的文章列表
-- - 如果不希望公开分享，请不要执行此脚本
-- - 你仍然可以通过浏览器扩展私密地管理你的文章
-- ====================================================================

-- 为 articles 表创建公开读取策略
-- 这将允许未认证用户读取文章列表（不包括删除和修改权限）

-- 1. 启用 RLS（如果尚未启用）
ALTER TABLE articles ENABLE ROW LEVEL SECURITY;

-- 2. 创建公开读取策略
-- 策略名称：allow_public_read
-- 作用：允许所有人（包括匿名用户）SELECT 查询文章
DROP POLICY IF EXISTS allow_public_read ON articles;

CREATE POLICY allow_public_read
ON articles
FOR SELECT
TO anon, authenticated  -- 允许匿名和认证用户
USING (true);          -- 所有行都可读

-- ====================================================================
-- 验证设置
-- ====================================================================
-- 
-- 执行以下查询验证策略是否生效:
-- 
-- SELECT * FROM articles LIMIT 5;
-- 
-- 如果能看到数据，说明设置成功！
-- ====================================================================

-- ====================================================================
-- 如何撤销公开访问（可选）
-- ====================================================================
-- 
-- 如果以后想要撤销公开访问，执行以下命令:
-- 
-- DROP POLICY IF EXISTS allow_public_read ON articles;
-- 
-- 撤销后，只有认证用户才能访问文章数据
-- ====================================================================
