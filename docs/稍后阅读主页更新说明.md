# 稍后阅读主页更新说明

## 更新日期
2025-11-27

## 主要改进

### 1. Header 图标优化
- ✅ 添加了 SideDoor 的 logo（`icon/128.png`），与扩展 popup 保持一致
- ✅ 调整了标题文字：从"🚪 SideDoor - 稍后阅读"改为"旁门 - 稍后阅读"
- ✅ 新增"安装扩展"按钮，方便用户下载安装

### 2. 文章卡片设计优化

#### 固定高度
- 统一卡片高度为 **420px**，确保整齐排列
- 卡片结构：
  - 封面图：180px（固定）
  - 内容区：自适应（flex: 1）
  - 操作按钮区：固定高度

#### Summary 显示优化
- 限制最多显示 **3 行**摘要
- 超出部分用省略号（...）代替
- 添加 `title` 属性，鼠标悬停时显示完整摘要（tooltip）
- 限制摘要长度为 120 字符

#### 元数据图标化
- 作者：添加用户图标 SVG
- 日期：添加日历图标 SVG
- 字数：保持原有表情符号

### 3. 按钮设计优化

完全参考扩展应用 popup 中的设计风格：

#### HTML 按钮
```html
<svg> <!-- 代码标签图标 --> </svg>
HTML
```

#### PDF 按钮
```html
<svg> <!-- 文档图标 --> </svg>
PDF
```

#### 原文按钮
```html
<svg> <!-- 外部链接图标 --> </svg>
原文
```

所有按钮：
- 使用 SVG 图标 + 文字
- 统一样式：`display: flex; align-items: center; gap: 4px`
- hover 效果：背景色变化 + 边框高亮

### 4. 按钮功能修复

#### 点击文章卡片
- **旧逻辑**：直接跳转到 `/reader.html?articleId={id}`（404 错误）
- **新逻辑**：
  - 检测是否在扩展环境中
  - 是：使用 `chrome.runtime.getURL()` 打开 reader 页面
  - 否：提示用户安装扩展

#### 点击 HTML 按钮
- **旧逻辑**：直接 `window.open(url)`（显示源码）
- **新逻辑**：
  - 异步获取 HTML 内容
  - 创建 Blob URL
  - 在新标签页打开（正确渲染）
  - 5 秒后清理 Blob URL

#### 点击 PDF 按钮
- 直接打开 URL（无变化）

#### 点击原文按钮
- 在新标签页打开原文 URL（无变化）

### 5. Popup 跳转链接

在扩展 popup 的 header 添加跳转链接：

#### PopupHome.vue
```vue
<a href="http://localhost:3001" target="_blank" class="home-link">
  <svg>外部链接图标</svg>
</a>
```

#### PopupReadLaterList.vue
同样添加了跳转链接，替代了原有的 `header-spacer`

样式特点：
- 28px × 28px 按钮
- hover 时高亮边框和文字颜色
- 与 back-btn 样式保持一致

### 6. 扩展安装功能

新增"安装扩展"按钮功能：

```javascript
window.downloadExtension = async function() {
  // 1. 尝试下载构建的 zip 包
  // 2. 显示安装说明
  // 3. 如果失败，提示用户其他安装方式
}
```

安装步骤提示：
1. 解压下载的 zip 文件
2. 打开 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择解压后的文件夹

### 7. 工具函数优化

#### escapeHtml()
防止 XSS 攻击，安全渲染用户内容

#### formatDate()
友好的日期显示：
- 今天
- 昨天
- X 天前
- 具体日期（超过 7 天）

## 文件变更清单

### 修改的文件
1. `public/read-later-standalone.html`
   - 添加 logo 和安装按钮
   - 优化卡片样式（固定高度、summary tooltip）
   - 添加 SVG 图标到所有按钮
   - 修复文章打开和 HTML 文件查看逻辑
   - 添加工具函数

2. `entrypoints/popup/PopupHome.vue`
   - header 添加跳转链接
   - 添加对应样式

3. `entrypoints/popup/PopupReadLaterList.vue`
   - header 添加跳转链接
   - 移除 header-spacer，替换为链接

4. `dev-server-unified.js`
   - 统一启动脚本（已创建）

5. `package.json`
   - 更新 `dev:with-server` 命令

## 启动方式

```bash
# 一键启动所有服务
npm run dev:with-server
```

同时启动：
- WXT 扩展开发服务器（端口 5173）
- test-page 测试页面（端口 8080）
- read-later 稍后阅读主页（端口 3001）

## 访问地址

- **扩展开发**: http://localhost:5173
- **测试页面**: http://localhost:8080
- **稍后阅读主页**: http://localhost:3001

## 已知问题

1. **扩展安装功能**：当前实现假设构建包在 `/.output/` 目录，实际项目可能需要调整路径
2. **跳转链接硬编码**：`http://localhost:3001` 在生产环境需要替换为实际域名

## 建议改进（未来）

1. 将稍后阅读主页 URL 配置化（环境变量）
2. 添加分享功能（分享单篇文章）
3. 添加标签筛选功能
4. 支持搜索文章
5. 添加阅读进度统计
6. 支持导出文章列表

## 测试清单

- [x] Header logo 显示正常
- [x] 安装扩展按钮点击有提示
- [x] 文章卡片高度一致
- [x] Summary hover 显示完整内容
- [x] 所有按钮图标显示正常
- [x] HTML 按钮打开文件正确渲染
- [x] PDF 按钮正常打开
- [x] 原文按钮正常跳转
- [x] 点击卡片在扩展环境中打开 reader
- [x] Popup 跳转链接正常工作
- [x] 主题切换功能正常
- [x] 响应式设计在移动端正常

## 参考资料

- ArticleCard.vue: 卡片设计参考
- PopupHome.vue: 交互逻辑参考
- PopupReadLaterList.vue: 列表展示参考
