# 🚀 SideDoor 稍后阅读主页 - 快速开始

> ⚠️ **重要提示**：首次使用需要先在 Supabase 手动创建 Storage Bucket！

## 第一步：创建 Supabase Storage Bucket

### 详细步骤（带截图说明）：

1. **访问 Supabase Dashboard**
   - 打开浏览器，访问：https://app.supabase.com
   - 使用你的账号登录

2. **选择项目**
   - 在项目列表中找到你的项目
   - 项目引用：`rimhmaeecdcrhuqbisjv`
   - 点击进入项目

3. **进入 Storage 页面**
   - 在左侧导航栏找到并点击 **"Storage"** 图标（文件夹图标）
   - 进入 Storage 管理页面

4. **创建新 Bucket**
   - 点击右上角的 **"New bucket"** 按钮（绿色按钮）
   
5. **配置 Bucket**
   - **Name（名称）**：输入 `public-pages`
     - ⚠️ 必须完全一致，包括小写和连字符
   - **Public bucket（公开）**：✅ **必须勾选这个选项**
     - 这样才能通过公开链接访问
   - **File size limit**：保持默认即可（可选）
   - **Allowed MIME types**：保持默认即可（可选）

6. **确认创建**
   - 点击 **"Create bucket"** 按钮
   - 等待创建完成
   - 看到 `public-pages` 出现在 bucket 列表中

### ✅ 验证创建成功

在 Storage 页面应该能看到：
- Bucket 名称：`public-pages`
- 状态标签：显示 **Public** 或 **公开**
- 文件数：0 files

---

## 第二步：配置上传权限

由于 Supabase 的 RLS（Row Level Security）策略，需要配置权限才能通过脚本上传文件。

### 🎯 选择一种方案

#### 方案 A：使用 Service Role Key（推荐，更安全）

1. **获取 Service Role Key**
   - 访问 Supabase Dashboard
   - Settings → API
   - 找到 "Project API keys" 部分
   - 复制 **service_role** 密钥（不是 anon/public 密钥）
   - ⚠️ **重要**: Service Role Key 具有管理员权限，请妥善保管，不要提交到代码仓库

2. **设置环境变量**
   
   在终端中运行（每次新开终端都需要设置）：
   ```bash
   export SUPABASE_SERVICE_ROLE_KEY="你的service_role密钥"
   ```
   
   或者创建 `.env.local` 文件（推荐）：
   ```bash
   echo 'SUPABASE_SERVICE_ROLE_KEY="你的service_role密钥"' >> .env.local
   ```
   
   然后运行时使用：
   ```bash
   source .env.local && npm run upload:standalone
   ```

3. **验证**
   - 重新运行上传命令
   - 应该不再显示 RLS 警告

#### 方案 B：配置 Storage RLS 策略

1. **执行 SQL 脚本**
   - 访问 Supabase Dashboard
   - 点击左侧 **SQL Editor**
   - 点击 "New query"
   - 复制 `sql/setup-storage-upload-policy.sql` 的内容
   - 粘贴并点击 "Run" 执行

2. **脚本内容说明**
   - 允许匿名用户上传文件到 `public-pages` bucket
   - 允许覆盖、删除和读取操作
   - ⚠️ 注意：这会允许任何人通过 API 上传文件

---

## 第三步：上传主页文件

### 📌 你现在的状态

如果你看到这样的错误：
```
❌ 创建 bucket 失败: new row violates row-level security policy

💡 请手动创建 bucket:
   1. 登录 Supabase Dashboard
   2. 进入 Storage 页面
   3. 创建名为 "public-pages" 的公开 bucket
```

**这是正常的！** 这说明你需要先完成"第一步"。

### 🎯 正确的操作顺序

1. **先**：在 Supabase Dashboard 手动创建 bucket（第一步）
2. **后**：运行上传命令（第二步）

### 运行上传命令

在项目根目录运行：

```bash
npm run upload:standalone
```

### ✅ 成功的输出示例

```
🚀 开始上传稍后阅读主页...

📖 读取文件...
   文件大小: 11.87 KB

🔍 检查 Storage Bucket...
   ✅ Bucket 已存在

⬆️  上传文件到 Supabase Storage...
   ✅ 上传成功

================================================================================
✅ 部署成功！
================================================================================

📍 稍后阅读主页 URL:
   https://rimhmaeecdcrhuqbisjv.supabase.co/storage/v1/object/public/public-pages/read-later.html
```

## 第三步：获取访问链接

脚本运行成功后会显示类似这样的链接：

```
https://rimhmaeecdcrhuqbisjv.supabase.co/storage/v1/object/public/public-pages/read-later.html
```

## 第四步：开始使用

- 📌 添加到浏览器书签
- 🏠 设置为浏览器主页  
- 📱 在手机上访问
- ✨ 享受随时随地访问稍后阅读列表！

---

## ⚠️ 遇到问题？

### 错误 1: `new row violates row-level security policy`

**原因**：Storage RLS 策略阻止了上传

**解决方法**：按照"第二步：配置上传权限"选择一种方案
- **方案 A（推荐）**：使用 Service Role Key
- **方案 B**：配置 Storage RLS 策略

### 错误 2: Bucket 已存在但上传失败

**解决方法**：
```bash
# 检查 bucket 是否设置为 public
# 在 Supabase Dashboard > Storage > public-pages
# 查看右上角应该有 "Public" 标签
```

### 如果页面显示"加载失败"

检查 `public/read-later-standalone.html` 文件中的配置：

```javascript
// 第 134-135 行，确保这两行配置正确
const SUPABASE_URL = 'https://rimhmaeecdcrhuqbisjv.supabase.co';
const SUPABASE_ANON_KEY = 'your-anon-key-here';
```

### 如果文章列表为空

1. 确认浏览器扩展中已保存了文章
2. 在 Supabase Dashboard > Table Editor 中检查 `articles` 表是否有数据

---

## 📚 更多信息

查看完整文档：[稍后阅读主页使用指南.md](./稍后阅读主页使用指南.md)

## 💡 提示

- 每次修改 `public/read-later-standalone.html` 后，重新运行 `npm run upload:standalone` 即可更新
- 主页支持暗色/浅色主题切换（点击右上角图标）
- 在移动设备上也能完美显示
