# 独立文章查看器实现说明

## 🎯 问题描述

原先点击稍后阅读主页中的文章卡片时，会提示需要安装浏览器扩展，无法独立工作。我们需要创建一个独立的文章查看页面，让稍后阅读主页可以在没有扩展的情况下也能正常阅读文章。

**重要区分：**
- ✅ **阅读模式（Reader）**：扩展应用嵌入页面的弹窗，解析当前网页内容，提供翻译、AI 总结等功能
- ✅ **稍后阅读查看器（Article View）**：独立的 Web 页面，从 Supabase 加载已保存的文章内容

## ⚠️ 命名冲突问题

原本创建的 `public/reader.html` 与扩展应用的 `entrypoints/reader/` 产生了冲突，导致：
- ❌ 扩展的阅读模式弹窗无法正常工作（一直显示"加载文章中..."）
- ❌ 从 popup 点击稍后阅读文章卡片也无法打开

**解决方案：**
- 将独立查看器重命名为 `article-view.html`，避免与扩展的 `reader.html` 冲突

## 📁 新增文件

### 1. `public/article-view.html`
独立的文章查看器页面（注意：不是 reader.html），包含以下功能：

**核心功能：**
- ✅ 通过 URL 参数 `?articleId=xxx` 获取文章 ID
- ✅ 从 Supabase REST API 加载文章数据
- ✅ 渲染文章标题、元数据（作者、日期、字数）
- ✅ 显示文章正文内容（支持 HTML 格式）
- ✅ 提供原文链接、HTML 版本、PDF 版本下载按钮
- ✅ 支持深色/浅色主题切换
- ✅ 响应式设计，适配移动端

**UI 设计：**
- 简洁的 Header（返回按钮 + Logo + 标题 + 主题切换）
- 文章标题和元数据展示区
- 格式化的文章内容区（支持图片、代码块、引用等）
- 优雅的排版和阅读体验

## 🔧 修改文件

### 1. `public/read-later-standalone.html`
修改点击文章卡片的行为（注意：使用 article-view.html 而不是 reader.html）：

**之前：**
```javascript
window.openArticle = function(id) {
  if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.getURL) {
    const readerUrl = chrome.runtime.getURL(`/reader.html?articleId=${id}`);
    window.open(readerUrl, '_blank');
  } else {
    alert('此功能需要安装 SideDoor 浏览器扩展才能使用...');
  }
};
```

**现在：**
```javascript
window.openArticle = function(id) {
  window.open(`/article-view.html?articleId=${id}`, '_blank');
};
```

### 2. `dev-server-unified.js`
添加对 `/article-view.html` 路径的支持：

```javascript
// 处理文章查看页面（注意：不是 reader.html）
if (req.url.startsWith('/article-view.html')) {
  if (existsSync(ARTICLE_VIEW_FILE)) {
    readFile(ARTICLE_VIEW_FILE, 'utf-8').then(data => {
      res.writeHead(200, {
        'Content-Type': 'text/html; charset=utf-8',
        'Cache-Control': 'no-cache',
      });
      res.end(data);
    }).catch(err => {
      console.error('❌ 读取文章查看页面失败:', err);
      res.writeHead(500, { 'Content-Type': 'text/plain; charset=utf-8' });
      res.end('Internal Server Error');
    });
  } else {
    res.writeHead(404, { 'Content-Type': 'text/plain; charset=utf-8' });
    res.end('Article view page not found');
  }
  return;
}
```

## 🎨 文章查看器页面特性

### 1. 文章元数据展示
```html
<div class="article-meta">
  - 作者（带图标）
  - 发布日期（智能格式化）
  - 文章字数
</div>
```

### 2. 操作按钮
```html
<div class="article-actions">
  - 原文链接（外部跳转）
  - HTML 版本（Blob URL 打开）
  - PDF 版本（直接下载）
</div>
```

### 3. 文章内容样式
- 支持标题 h1-h6
- 支持图片（max-width: 100%，圆角）
- 支持代码块（带语法高亮样式）
- 支持引用块（左侧高亮条）
- 支持列表（ul/ol）
- 支持表格（带边框和样式）
- 支持链接（hover 效果）

### 4. 响应式设计
```css
@media (max-width: 768px) {
  - 缩小 header 内边距
  - 调整标题大小
  - 优化内容字体大小
  - 适配移动端布局
}
```

## 🚀 使用方式

### 开发环境
```bash
npm run dev:with-server
```

访问地址：
- 稍后阅读主页: http://localhost:3001
- 文章查看器示例: http://localhost:3001/article-view.html?articleId=xxx

### 用户流程
1. 打开稍后阅读主页 (http://localhost:3001)
2. 点击任意文章卡片
3. 在新标签页打开文章查看器 (`/article-view.html?articleId=xxx`)
4. 查看文章内容，可以：
   - 点击"原文链接"查看原网页
   - 点击"HTML 版本"下载离线 HTML
   - 点击"PDF 版本"下载 PDF
   - 切换主题（深色/浅色）
   - 点击返回按钮回到列表页

## 🎯 技术实现

### 1. 从 Supabase 加载文章
```javascript
async function loadArticle(id) {
  const response = await fetch(
    `${SUPABASE_URL}/rest/v1/articles?select=*&id=eq.${id}`,
    {
      headers: {
        'apikey': SUPABASE_ANON_KEY,
        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
      }
    }
  );
  const articles = await response.json();
  const article = articles[0];
  renderArticle(article);
}
```

### 2. 渲染文章内容
```javascript
function renderArticle(article) {
  // 更新页面标题
  document.title = `${article.title} - SideDoor`;
  
  // 渲染 HTML
  document.getElementById('article').innerHTML = `
    <div class="article-header">...</div>
    <div class="article-content">${article.content}</div>
  `;
}
```

### 3. 主题持久化
```javascript
// 保存到 localStorage
localStorage.setItem('theme', newTheme);

// 页面加载时恢复
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
```

### 4. 返回导航
```javascript
function goBack() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = '/read-later-standalone.html';
  }
}
```

## ✨ 优势

1. **完全独立** - 不依赖浏览器扩展，可作为独立 Web 应用使用
2. **无缝集成** - 与稍后阅读主页完美配合
3. **优雅体验** - 简洁的阅读界面，专注于内容
4. **功能完整** - 支持主题、导航、下载等所有必要功能
5. **响应式** - 完美适配桌面端和移动端
6. **可扩展** - 易于添加新功能（评论、分享、收藏等）

## 🔄 与扩展版阅读器的区别

| 特性 | 扩展版阅读器 (Reader) | 独立文章查看器 (Article View) |
|------|---------------------|----------------------------|
| 文件路径 | `entrypoints/reader/` | `public/article-view.html` |
| 运行环境 | Chrome 扩展（iframe/新标签） | Web 浏览器 |
| 主要用途 | 解析当前网页，提供阅读模式 | 查看已保存的稍后阅读文章 |
| 依赖项 | 需要安装扩展 | 无需安装 |
| 功能丰富度 | 非常丰富（AI 总结、翻译、笔记等） | 基础阅读 |
| 访问方式 | `chrome-extension://.../reader.html` | `http://localhost:3001/article-view.html` |
| 数据来源 | 当前页面 DOM + Supabase | 仅 Supabase |
| 用户群 | 安装扩展的用户 | 所有访问网站的用户 |
| URL 参数 | `?url=xxx` 或 `?articleId=xxx` | 仅 `?articleId=xxx` |

## ⚠️ 重要提醒

**绝对不要修改或删除 `entrypoints/reader/` 目录！**

这是扩展应用的核心功能，用于：
1. 在当前网页上弹出阅读模式浮窗
2. 解析网页内容并转换为阅读格式
3. 提供 AI 总结、翻译、笔记等高级功能
4. 从 popup 或稍后阅读列表中打开保存的文章

`public/article-view.html` 是一个完全独立的页面，仅用于稍后阅读主页（http://localhost:3001），不影响扩展的任何功能。

## 📝 后续优化建议

1. **功能增强**
   - 添加文章评论功能
   - 添加社交分享按钮
   - 添加字体大小调节
   - 添加阅读进度保存

2. **性能优化**
   - 图片懒加载
   - 内容分页（长文章）
   - 离线缓存支持

3. **用户体验**
   - 添加阅读时间估算
   - 添加目录导航（TOC）
   - 添加全文搜索
   - 添加打印优化样式

4. **SEO 优化**
   - 添加 meta 标签
   - 优化 Open Graph 标签
   - 生成静态 HTML（SSG）

## 🎉 总结

现在稍后阅读主页是一个完全独立的 Web 应用，用户可以：
1. 浏览文章列表
2. 点击文章卡片在新标签页查看详情（`article-view.html`）
3. 阅读完整的文章内容
4. 下载 HTML/PDF 版本
5. 查看原文链接

**完全不需要依赖浏览器扩展！** 🚀

同时，扩展应用的阅读模式（`reader.html`）继续正常工作：
- ✅ 嵌入页面的阅读模式弹窗
- ✅ 从 popup 打开稍后阅读文章
- ✅ AI 总结、翻译等高级功能
- ✅ 所有原有功能完全不受影响

两个系统各司其职，互不干扰！ 🎯
