# ğŸš€ éƒ¨ç½²ç¨åé˜…è¯»ä¸»é¡µåˆ°äº‘æœåŠ¡å™¨

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å°†ç¨åé˜…è¯»ä¸»é¡µéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ï¼Œä½¿ç”¨ Nginx æä¾›æœåŠ¡ã€‚

---

## ğŸ“‹ å‰ç½®è¦æ±‚

- äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWS ç­‰ï¼‰
- å·²å®‰è£… Nginx
- å·²å®‰è£… Node.jsï¼ˆå¦‚æœä½¿ç”¨ Node.js æœåŠ¡ï¼‰
- åŸŸåï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ç”¨ IP è®¿é—®ï¼‰

---

## ğŸ¯ æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆ Aï¼šNginx ç›´æ¥æä¾›é™æ€æ–‡ä»¶ï¼ˆâ­ æ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- ç®€å•ã€é«˜æ•ˆ
- æ— éœ€è¿è¡Œé¢å¤–çš„ Node.js è¿›ç¨‹
- èµ„æºå ç”¨å°‘

**é€‚ç”¨åœºæ™¯**ï¼š
- åªéœ€è¦æä¾› HTML é¡µé¢
- ä¸éœ€è¦åŠ¨æ€å¤„ç†

### æ–¹æ¡ˆ Bï¼šNginx åå‘ä»£ç†åˆ° Node.js æœåŠ¡

**ä¼˜ç‚¹**ï¼š
- å¯ä»¥æ·»åŠ è‡ªå®šä¹‰é€»è¾‘
- æ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦åŠ¨æ€å¤„ç†è¯·æ±‚
- éœ€è¦é¢å¤–çš„åç«¯åŠŸèƒ½

---

## ğŸ“¦ æ–¹æ¡ˆ Aï¼šé™æ€æ–‡ä»¶éƒ¨ç½²

### 1. å‡†å¤‡æ–‡ä»¶

åœ¨æœ¬åœ°æ‰“åŒ…ï¼š

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir -p deploy

# å¤åˆ¶ HTML æ–‡ä»¶
cp public/read-later-standalone.html deploy/

# å¯é€‰ï¼šå‹ç¼©æ‰“åŒ…
tar -czf read-later-deploy.tar.gz deploy/
```

### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä½¿ç”¨ scp ä¸Šä¼ 
scp -r deploy/ user@your-server-ip:/var/www/sidedoor/

# æˆ–è€…ä½¿ç”¨ rsync
rsync -avz deploy/ user@your-server-ip:/var/www/sidedoor/
```

### 3. é…ç½® Nginx

```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh user@your-server-ip

# åˆ›å»º nginx é…ç½®
sudo nano /etc/nginx/sites-available/sidedoor-read-later
```

ç²˜è´´ä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;  # æˆ–ä½¿ç”¨ IP

    root /var/www/sidedoor/deploy;
    
    location / {
        try_files /read-later-standalone.html =404;
        
        # æ­£ç¡®çš„ Content-Type
        add_header Content-Type "text/html; charset=utf-8";
        
        # CORSï¼ˆå¦‚æœéœ€è¦ï¼‰
        add_header Access-Control-Allow-Origin "*";
        add_header Access-Control-Allow-Methods "GET, OPTIONS";
        
        # ç¼“å­˜
        add_header Cache-Control "public, max-age=3600";
    }

    location /health {
        access_log off;
        return 200 '{"status":"ok"}';
        add_header Content-Type application/json;
    }
}
```

### 4. å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥ï¼ˆUbuntu/Debianï¼‰
sudo ln -s /etc/nginx/sites-available/sidedoor-read-later /etc/nginx/sites-enabled/

# æˆ–ç›´æ¥ä½¿ç”¨ï¼ˆCentOS/RHELï¼‰
# é…ç½®æ–‡ä»¶å·²åœ¨ /etc/nginx/conf.d/ ä¸­

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½ Nginx
sudo systemctl reload nginx
```

### 5. æµ‹è¯•è®¿é—®

```bash
# æœ¬åœ°æµ‹è¯•
curl http://your-server-ip/

# æŸ¥çœ‹å“åº”å¤´
curl -I http://your-server-ip/
```

æµè§ˆå™¨è®¿é—®ï¼š`http://your-server-ip` æˆ– `http://your-domain.com`

---

## ğŸ”§ æ–¹æ¡ˆ Bï¼šNode.js æœåŠ¡ + Nginx åå‘ä»£ç†

### 1. å‡†å¤‡æ–‡ä»¶

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir -p deploy

# å¤åˆ¶å¿…è¦æ–‡ä»¶
cp serve-read-later.js deploy/
cp public/read-later-standalone.html deploy/
cp package.json deploy/
```

### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
scp -r deploy/ user@your-server-ip:/var/www/sidedoor/
```

### 3. åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–

```bash
ssh user@your-server-ip
cd /var/www/sidedoor/deploy

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
npm install --production
```

### 4. ä½¿ç”¨ PM2 è¿è¡Œ Node.js æœåŠ¡

```bash
# å®‰è£… PM2
sudo npm install -g pm2

# å¯åŠ¨æœåŠ¡
pm2 start serve-read-later.js --name read-later-home

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs read-later-home
```

### 5. é…ç½® Nginx åå‘ä»£ç†

```bash
sudo nano /etc/nginx/sites-available/sidedoor-read-later
```

ç²˜è´´é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 6. å¯ç”¨é…ç½®

```bash
sudo ln -s /etc/nginx/sites-available/sidedoor-read-later /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ” é…ç½® HTTPSï¼ˆæ¨èï¼‰

### ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# Certbot ä¼šè‡ªåŠ¨é…ç½® Nginx
# è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸ
```

### æ‰‹åŠ¨é…ç½® HTTPS

å¦‚æœå·²æœ‰è¯ä¹¦ï¼š

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # ... å…¶ä»–é…ç½®
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ–¹æ¡ˆ Aï¼ˆé™æ€æ–‡ä»¶ï¼‰

```bash
# æœ¬åœ°
cp public/read-later-standalone.html deploy/

# ä¸Šä¼ 
scp deploy/read-later-standalone.html user@your-server-ip:/var/www/sidedoor/deploy/

# æœåŠ¡å™¨ä¸Šæ— éœ€é‡å¯
# ç›´æ¥åˆ·æ–°æµè§ˆå™¨å³å¯
```

### æ–¹æ¡ˆ Bï¼ˆNode.js æœåŠ¡ï¼‰

```bash
# ä¸Šä¼ æ›´æ–°
scp serve-read-later.js user@your-server-ip:/var/www/sidedoor/deploy/
scp public/read-later-standalone.html user@your-server-ip:/var/www/sidedoor/deploy/

# æœåŠ¡å™¨ä¸Šé‡å¯æœåŠ¡
ssh user@your-server-ip
pm2 restart read-later-home
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### Nginx æ—¥å¿—

```bash
# è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/sidedoor-read-later-access.log

# é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/sidedoor-read-later-error.log
```

### PM2 æ—¥å¿—ï¼ˆæ–¹æ¡ˆ Bï¼‰

```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs read-later-home

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# é‡å¯æœåŠ¡
pm2 restart read-later-home
```

---

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **é˜²ç«å¢™é…ç½®**
   ```bash
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   sudo ufw enable
   ```

2. **é™åˆ¶è®¿é—®é€Ÿç‡**ï¼ˆNginxï¼‰
   ```nginx
   limit_req_zone $binary_remote_addr zone=readlater:10m rate=10r/s;
   
   server {
       location / {
           limit_req zone=readlater burst=20;
           # ... å…¶ä»–é…ç½®
       }
   }
   ```

3. **æ·»åŠ è®¿é—®æ§åˆ¶**ï¼ˆå¯é€‰ï¼‰
   ```nginx
   location / {
       # åªå…è®¸ç‰¹å®š IP
       allow 1.2.3.4;
       deny all;
       
       # ... å…¶ä»–é…ç½®
   }
   ```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q: é¡µé¢æ˜¾ç¤º 502 Bad Gateway

A: æ£€æŸ¥ Node.js æœåŠ¡æ˜¯å¦è¿è¡Œï¼š
```bash
pm2 status
pm2 logs read-later-home
```

### Q: é¡µé¢æ˜¾ç¤ºæºä»£ç 

A: æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ Content-Typeï¼š
```bash
curl -I http://your-domain.com/
# åº”è¯¥çœ‹åˆ°: Content-Type: text/html
```

### Q: æ— æ³•è®¿é—®

A: æ£€æŸ¥é˜²ç«å¢™å’Œ Nginx çŠ¶æ€ï¼š
```bash
sudo systemctl status nginx
sudo ufw status
```

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„ç¨åé˜…è¯»ä¸»é¡µå·²ç»éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨äº†ï¼

**è®¿é—®æ–¹å¼**ï¼š
- HTTP: `http://your-domain.com`
- HTTPS: `https://your-domain.com`

**æ›´å¤šå‚è€ƒ**ï¼š
- é¡¹ç›®ä¸­çš„ `nginx.conf.example` - Nginx é…ç½®ç¤ºä¾‹
- `serve-read-later.js` - Node.js æœåŠ¡è„šæœ¬
